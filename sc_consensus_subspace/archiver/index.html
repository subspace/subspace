<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Consensus archiver responsible for archival of blockchain history, it is driven by block import pipeline."><title>sc_consensus_subspace::archiver - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-46f98efaafac5295.ttf.woff2,FiraSans-Regular-018c141bf0843ffd.woff2,FiraSans-Medium-8f9a781e4970d388.woff2,SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2,SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../static.files/rustdoc-081576b923113409.css"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="sc_consensus_subspace" data-themes="" data-resource-suffix="" data-rustdoc-version="1.79.0-nightly (fb898629a 2024-04-21)" data-channel="nightly" data-search-js="search-bf21c90c8c1d92b1.js" data-settings-js="settings-4313503d2e1961c2.js" ><script src="../../static.files/storage-e32f0c247825364d.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../static.files/main-20a3ad099b048cf2.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-09095024cf37855e.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../sc_consensus_subspace/index.html">sc_consensus_subspace</a><span class="version">0.1.0</span></h2></div><h2 class="location"><a href="#">Module archiver</a></h2><div class="sidebar-elems"><section><ul class="block"><li><a href="#structs">Structs</a></li><li><a href="#functions">Functions</a></li></ul></section><h2><a href="../index.html">In crate sc_consensus_subspace</a></h2></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><div id="sidebar-button" tabindex="-1"><a href="../../sc_consensus_subspace/all.html" title="show sidebar"></a></div><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Type ‘S’ or ‘/’ to search, ‘?’ for more options…" type="search"><div id="help-button" tabindex="-1"><a href="../../help.html" title="help">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../settings.html" title="settings">Settings</a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Module <a href="../index.html">sc_consensus_subspace</a>::<wbr><a class="mod" href="#">archiver</a><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><span class="out-of-band"><a class="src" href="../../src/sc_consensus_subspace/archiver.rs.html#17-1057">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Consensus archiver responsible for archival of blockchain history, it is driven by block import
pipeline.</p>
<p>Implements archiving process in Subspace blockchain that converts blockchain history (blocks)
into archived history (pieces).</p>
<p>The main entry point here is <a href="fn.create_subspace_archiver.html" title="fn sc_consensus_subspace::archiver::create_subspace_archiver"><code>create_subspace_archiver</code></a> that will create a task, which while
driven will perform the archiving itself.</p>
<p>Archiving is triggered by block importing notification (<a href="../struct.SubspaceLink.html#method.block_importing_notification_stream" title="method sc_consensus_subspace::SubspaceLink::block_importing_notification_stream"><code>SubspaceLink::block_importing_notification_stream</code></a>)
and tries to archive the block at <a href="sp_consensus_subspace::ChainConstants::confirmation_depth_k"><code>ChainConstants::confirmation_depth_k</code></a>
depth from the block being imported. Block import will then wait for archiver to acknowledge
processing, which is necessary for ensuring that when the next block is imported, inherents will
contain segment header of newly archived block (must happen exactly in the next block).</p>
<p>Archiving itself will also wait for acknowledgement by various subscribers before proceeding,
which includes farmer subscription, in case of reference implementation via RPC
(<code>sc-consensus-subspace-rpc</code>), but could also be in other ways.</p>
<p><a href="struct.SegmentHeadersStore.html" title="struct sc_consensus_subspace::archiver::SegmentHeadersStore"><code>SegmentHeadersStore</code></a> is maintained as a data structure containing all known (including future
in case of syncing) segment headers. This data structure contents is then made available to
other parts of the protocol that need to know what correct archival history of the blockchain
looks like. For example, it is used during node sync and farmer plotting in order to verify
pieces of archival history received from other network participants.</p>
<p><a href="fn.recreate_genesis_segment.html" title="fn sc_consensus_subspace::archiver::recreate_genesis_segment"><code>recreate_genesis_segment</code></a> is a bit of a hack and is useful for deriving of the genesis
segment that is special case since we don’t have enough data in the blockchain history itself
during genesis in order to do the archiving.</p>
<p><a href="fn.encode_block.html" title="fn sc_consensus_subspace::archiver::encode_block"><code>encode_block</code></a> and <a href="fn.decode_block.html" title="fn sc_consensus_subspace::archiver::decode_block"><code>decode_block</code></a> are symmetric encoding/decoding functions turning
[<code>SignedBlock</code>]s into bytes and back.</p>
</div></details><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.ArchivedSegmentNotification.html" title="struct sc_consensus_subspace::archiver::ArchivedSegmentNotification">ArchivedSegmentNotification</a></div><div class="desc docblock-short">Notification with block header hash that needs to be signed and sender for signature.</div></li><li><div class="item-name"><a class="struct" href="struct.SegmentHeadersStore.html" title="struct sc_consensus_subspace::archiver::SegmentHeadersStore">SegmentHeadersStore</a></div><div class="desc docblock-short">Persistent storage of segment headers.</div></li></ul><h2 id="functions" class="section-header">Functions<a href="#functions" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="fn" href="fn.create_subspace_archiver.html" title="fn sc_consensus_subspace::archiver::create_subspace_archiver">create_subspace_archiver</a></div><div class="desc docblock-short">Crate an archiver task that will listen for importing blocks and archive blocks at <code>K</code> depth,
producing pieces and segment headers (segment headers are then added back to the blockchain as
<code>store_segment_header</code> extrinsic).</div></li><li><div class="item-name"><a class="fn" href="fn.decode_block.html" title="fn sc_consensus_subspace::archiver::decode_block">decode_block</a></div><div class="desc docblock-short">Symmetrical to <a href="fn.encode_block.html" title="fn sc_consensus_subspace::archiver::encode_block"><code>encode_block()</code></a>, used to decode previously encoded blocks</div></li><li><div class="item-name"><a class="fn" href="fn.encode_block.html" title="fn sc_consensus_subspace::archiver::encode_block">encode_block</a></div><div class="desc docblock-short">Encode block for archiving purposes.</div></li><li><div class="item-name"><a class="fn" href="fn.recreate_genesis_segment.html" title="fn sc_consensus_subspace::archiver::recreate_genesis_segment">recreate_genesis_segment</a></div><div class="desc docblock-short">Derive genesis segment on demand, returns <code>Ok(None)</code> in case genesis block was already pruned</div></li></ul></section></div></main></body></html>