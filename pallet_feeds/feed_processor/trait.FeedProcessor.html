<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Feed Processor"><title>FeedProcessor in pallet_feeds::feed_processor - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceSerif4-Bold-a2c9cd1067f8b328.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../static.files/rustdoc-cb6f1f67f1bcd037.css" id="mainThemeStyle"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="pallet_feeds" data-themes="" data-resource-suffix="" data-rustdoc-version="1.73.0-nightly (399b06823 2023-07-20)" data-channel="nightly" data-search-js="search-6dfdfced5eff6596.js" data-settings-js="settings-de11bff964e9d4e5.js" data-settings-css="settings-8c76f75bfb6bd192.css" data-theme-light-css="light-6d2c9675f3d09c26.css" data-theme-dark-css="dark-45ceb8f2e522f4d1.css" data-theme-ayu-css="ayu-fd19013d6ce078bf.css" ><script src="../../static.files/storage-db41da1a38ea3cb8.js"></script><script defer src="sidebar-items.js"></script><script defer src="../../static.files/main-0795b7d26be81095.js"></script><noscript><link rel="stylesheet" media="(prefers-color-scheme:light)" href="../../static.files/light-6d2c9675f3d09c26.css"><link rel="stylesheet" media="(prefers-color-scheme:dark)" href="../../static.files/dark-45ceb8f2e522f4d1.css"><link rel="stylesheet" href="../../static.files/noscript-cffde32267a19fd6.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc trait"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="logo-container" href="../../pallet_feeds/index.html"><img class="rust-logo" src="../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2></h2></nav><nav class="sidebar"><a class="logo-container" href="../../pallet_feeds/index.html"><img class="rust-logo" src="../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2 class="location"><a href="#">FeedProcessor</a></h2><div class="sidebar-elems"><section><h3><a href="#required-methods">Required Methods</a></h3><ul class="block"><li><a href="#tymethod.object_mappings">object_mappings</a></li></ul><h3><a href="#provided-methods">Provided Methods</a></h3><ul class="block"><li><a href="#method.delete">delete</a></li><li><a href="#method.init">init</a></li><li><a href="#method.put">put</a></li></ul><h3><a href="#foreign-impls">Implementations on Foreign Types</a></h3><ul class="block"><li><a href="#impl-FeedProcessor%3CFeedId%3E-for-()">()</a></li></ul><h3><a href="#implementors">Implementors</a></h3></section><h2><a href="index.html">In pallet_feeds::feed_processor</a></h2></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Trait <a href="../index.html">pallet_feeds</a>::<wbr><a href="index.html">feed_processor</a>::<wbr><a class="trait" href="#">FeedProcessor</a><button id="copy-path" title="Copy item path to clipboard"><img src="../../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="src" href="../../src/pallet_feeds/feed_processor.rs.html#119-139">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><pre class="rust item-decl"><code>pub trait FeedProcessor&lt;FeedId&gt; {
    // Required method
    fn <a href="#tymethod.object_mappings" class="fn">object_mappings</a>(
        &amp;self,
        _feed_id: FeedId,
        object: &amp;[<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.u8.html">u8</a>]
    ) -&gt; <a class="struct" href="https://doc.rust-lang.org/nightly/alloc/vec/struct.Vec.html" title="struct alloc::vec::Vec">Vec</a>&lt;<a class="enum" href="enum.FeedObjectMapping.html" title="enum pallet_feeds::feed_processor::FeedObjectMapping">FeedObjectMapping</a>&gt;;

    // Provided methods
    fn <a href="#method.init" class="fn">init</a>(&amp;self, _feed_id: FeedId, _data: &amp;[<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.u8.html">u8</a>]) -&gt; DispatchResult { ... }
<span class="item-spacer"></span>    fn <a href="#method.put" class="fn">put</a>(
        &amp;self,
        _feed_id: FeedId,
        _object: &amp;[<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.u8.html">u8</a>]
    ) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="enum" href="https://doc.rust-lang.org/nightly/core/option/enum.Option.html" title="enum core::option::Option">Option</a>&lt;<a class="type" href="type.FeedMetadata.html" title="type pallet_feeds::feed_processor::FeedMetadata">FeedMetadata</a>&gt;, DispatchError&gt; { ... }
<span class="item-spacer"></span>    fn <a href="#method.delete" class="fn">delete</a>(&amp;self, _feed_id: FeedId) -&gt; DispatchResult { ... }
}</code></pre><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><h2 id="feed-processor"><a href="#feed-processor">Feed Processor</a></h2>
<p>Feed Processor defines some useful abstractions that are used during the life cycle of the Feed and its objects.
We can provide some custom logic specific to the Feed by implementing a Custom Feed Processor.</p>
<h3 id="feed-metadata"><a href="#feed-metadata">Feed Metadata</a></h3>
<p>Before an object is added to Subspace storage, <code>put</code> on Feed processor to give the impl an opportunity to run the object
through their custom logic and returns some metadata about the object. Metadata is then stored in the runtime overwriting
any metadata of the previous object. The default implementation of Feed processor gives empty metadata about the object.</p>
<h3 id="feed-object-mapping"><a href="#feed-object-mapping">Feed object mapping</a></h3>
<p>Feed indexes the objects in the DSN using offsets within the Block the object is present in. <code>object_mappings</code> is the
only that must be implemented by the Feed processor. Since DSN is a key value store, there are two different ways keys
are derived for given data at the offset within the block</p>
<ul>
<li>Key derived from content. Feeds use BLAKE2b-256 to derive the key for the data at the offset.</li>
<li>Key provided by the feed processor. Feed processor implementations can instead provide a key for object at the offset.</li>
</ul>
<h3 id="examples"><a href="#examples">Examples</a></h3><h4 id="content-based-addressing-with-default-hasher"><a href="#content-based-addressing-with-default-hasher">Content based addressing with default hasher</a></h4>
<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>pallet_feeds::feed_processor::{FeedProcessor, FeedObjectMapping};
<span class="kw">struct </span>IPFSLike;
<span class="kw">impl</span>&lt;FeedId&gt; FeedProcessor&lt;FeedId&gt; <span class="kw">for </span>IPFSLike { <span class="doccomment">///
    </span><span class="kw">fn </span>object_mappings(<span class="kw-2">&amp;</span><span class="self">self</span>, _feed_id: FeedId, _object: <span class="kw-2">&amp;</span>[u8]) -&gt; Vec&lt;FeedObjectMapping&gt; {
        <span class="macro">vec!</span>[FeedObjectMapping::Content { offset: <span class="number">0 </span>}]
    }
}</code></pre></div>
<p>This implements a Content addressable Feed using default Hasher. The entire object is treated as data and hence the offset is zero.</p>
<h4 id="content-based-addressing-using-custom-hasher"><a href="#content-based-addressing-using-custom-hasher">Content based addressing using custom Hasher</a></h4>
<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>sp_runtime::traits::{BlakeTwo256, Hash};
<span class="kw">use </span>pallet_feeds::feed_processor::{FeedProcessor, FeedObjectMapping};
<span class="kw">struct </span>IPFSLike;
<span class="kw">impl</span>&lt;FeedId&gt; FeedProcessor&lt;FeedId&gt; <span class="kw">for </span>IPFSLike { <span class="doccomment">///
    </span><span class="kw">fn </span>object_mappings(<span class="kw-2">&amp;</span><span class="self">self</span>, _feed_id: FeedId, object: <span class="kw-2">&amp;</span>[u8]) -&gt; Vec&lt;FeedObjectMapping&gt; {
        <span class="macro">vec!</span>[FeedObjectMapping::Custom { key: BlakeTwo256::hash(object).as_bytes().to_vec(), offset: <span class="number">0 </span>}]
    }
}</code></pre></div>
<p>This implements a Content addressable Feed using BlakeTwo256 hasher. The entire object is treated as data and hence the offset is zero.</p>
</div></details><h2 id="required-methods" class="small-section-header">Required Methods<a href="#required-methods" class="anchor">§</a></h2><div class="methods"><details class="toggle method-toggle" open><summary><section id="tymethod.object_mappings" class="method"><a class="src rightside" href="../../src/pallet_feeds/feed_processor.rs.html#133">source</a><h4 class="code-header">fn <a href="#tymethod.object_mappings" class="fn">object_mappings</a>(
    &amp;self,
    _feed_id: FeedId,
    object: &amp;[<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.u8.html">u8</a>]
) -&gt; <a class="struct" href="https://doc.rust-lang.org/nightly/alloc/vec/struct.Vec.html" title="struct alloc::vec::Vec">Vec</a>&lt;<a class="enum" href="enum.FeedObjectMapping.html" title="enum pallet_feeds::feed_processor::FeedObjectMapping">FeedObjectMapping</a>&gt;</h4></section></summary><div class="docblock"><p>Returns any object mappings inside the given object</p>
</div></details></div><h2 id="provided-methods" class="small-section-header">Provided Methods<a href="#provided-methods" class="anchor">§</a></h2><div class="methods"><details class="toggle method-toggle" open><summary><section id="method.init" class="method"><a class="src rightside" href="../../src/pallet_feeds/feed_processor.rs.html#122-124">source</a><h4 class="code-header">fn <a href="#method.init" class="fn">init</a>(&amp;self, _feed_id: FeedId, _data: &amp;[<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.u8.html">u8</a>]) -&gt; DispatchResult</h4></section></summary><div class="docblock"><p>Initiates a specific Feed with data transparent to FeedProcessor
Can be called when re-initializing the feed.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.put" class="method"><a class="src rightside" href="../../src/pallet_feeds/feed_processor.rs.html#128-130">source</a><h4 class="code-header">fn <a href="#method.put" class="fn">put</a>(
    &amp;self,
    _feed_id: FeedId,
    _object: &amp;[<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.u8.html">u8</a>]
) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="enum" href="https://doc.rust-lang.org/nightly/core/option/enum.Option.html" title="enum core::option::Option">Option</a>&lt;<a class="type" href="type.FeedMetadata.html" title="type pallet_feeds::feed_processor::FeedMetadata">FeedMetadata</a>&gt;, DispatchError&gt;</h4></section></summary><div class="docblock"><p>Puts a feed and returns the Metadata if any.
This is called once per extrinsic that puts a feed into a given feed stream.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.delete" class="method"><a class="src rightside" href="../../src/pallet_feeds/feed_processor.rs.html#136-138">source</a><h4 class="code-header">fn <a href="#method.delete" class="fn">delete</a>(&amp;self, _feed_id: FeedId) -&gt; DispatchResult</h4></section></summary><div class="docblock"><p>Signals a delete to any underlying feed data.</p>
</div></details></div><h2 id="foreign-impls" class="small-section-header">Implementations on Foreign Types<a href="#foreign-impls" class="anchor">§</a></h2><details class="toggle implementors-toggle"><summary><section id="impl-FeedProcessor%3CFeedId%3E-for-()" class="impl"><a class="src rightside" href="../../src/pallet_feeds/feed_processor.rs.html#144-149">source</a><a href="#impl-FeedProcessor%3CFeedId%3E-for-()" class="anchor">§</a><h3 class="code-header">impl&lt;FeedId&gt; <a class="trait" href="trait.FeedProcessor.html" title="trait pallet_feeds::feed_processor::FeedProcessor">FeedProcessor</a>&lt;FeedId&gt; for <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a></h3></section></summary><div class="docblock"><p>Content addressable feed processor impl
Offsets the whole object as content thereby signalling to derive <code>key = hash(object)</code>
Put do not provide any metadata.</p>
</div><div class="impl-items"><details class="toggle method-toggle" open><summary><section id="method.object_mappings" class="method trait-impl"><a class="src rightside" href="../../src/pallet_feeds/feed_processor.rs.html#146-148">source</a><a href="#method.object_mappings" class="anchor">§</a><h4 class="code-header">fn <a href="#tymethod.object_mappings" class="fn">object_mappings</a>(
    &amp;self,
    _feed_id: FeedId,
    _object: &amp;[<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.u8.html">u8</a>]
) -&gt; <a class="struct" href="https://doc.rust-lang.org/nightly/alloc/vec/struct.Vec.html" title="struct alloc::vec::Vec">Vec</a>&lt;<a class="enum" href="enum.FeedObjectMapping.html" title="enum pallet_feeds::feed_processor::FeedObjectMapping">FeedObjectMapping</a>&gt;</h4></section></summary><div class="docblock"><p>Maps the entire object as content.</p>
</div></details></div></details><h2 id="implementors" class="small-section-header">Implementors<a href="#implementors" class="anchor">§</a></h2><div id="implementors-list"></div><script src="../../implementors/pallet_feeds/feed_processor/trait.FeedProcessor.js" data-ignore-extern-crates="std" async></script></section></div></main></body></html>